<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>NEXGEN SIDE ENGINE v1.5.0</title>
  <style>
    body {
      margin: 0;
      display: flex;
      height: 100vh;
      font-family: Arial, sans-serif;
      background: #1a1a1a;
    }
    /* Container untuk preview dan header */
    #gameContainer {
      flex: 3;
      background: #333;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding-top: 40px;
    }
    /* Header Engine */
    #header {
      position: absolute;
      top: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.7);
      color: #fff;
      text-align: center;
      padding: 8px 0;
      font-size: 18px;
      font-weight: bold;
    }
    /* Preview Frame */
    #previewFrame {
      width: 800px;
      height: 600px;
      border: 2px solid #00bcd4;
      background: #fff;
    }
    /* Editor Container */
    #editorContainer {
      flex: 1;
      padding: 10px;
      background: #f4f4f4;
      border-left: 2px solid #ccc;
      box-sizing: border-box;
      overflow-y: auto;
    }
    .editorGroup {
      margin-bottom: 10px;
    }
    .editorGroup label {
      font-weight: bold;
      display: block;
      margin-bottom: 4px;
    }
    textarea {
      width: 100%;
      height: 80px;
      font-family: monospace;
      font-size: 14px;
      resize: vertical;
      padding: 5px;
      box-sizing: border-box;
    }
    .btn {
      width: 100%;
      margin-top: 10px;
      padding: 10px;
      background: #00bcd4;
      color: white;
      border: none;
      cursor: pointer;
      font-size: 14px;
      border-radius: 4px;
    }
    /* Credits */
    #credits {
      position: absolute;
      bottom: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.5);
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 12px;
      color: #ccc;
    }
    /* Debug Panel */
    #debugPanel {
      position: absolute;
      top: 40px;
      right: 10px;
      background: rgba(0, 0, 0, 0.7);
      color: #fff;
      padding: 8px;
      border-radius: 4px;
      font-size: 12px;
      min-width: 140px;
    }
    /* Console Panel */
    #consolePanel {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 300px;
      max-height: 150px;
      background: rgba(0, 0, 0, 0.85);
      color: #0f0;
      font-size: 12px;
      overflow-y: auto;
      padding: 5px;
      border-top-right-radius: 8px;
      white-space: pre-wrap;
      display: none;
    }
    #toggleConsole, #clearConsole {
      position: absolute;
      bottom: 160px;
      left: 10px;
      background: #00bcd4;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }
    #clearConsole {
      bottom: 130px;
      left: 10px;
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <div id="header">NEXGEN SIDE ENGINE v1.5.0</div>
    <iframe id="previewFrame"></iframe>
    <div id="credits">Â© 2025 NexGen Game Studios</div>
    <div id="debugPanel">
      <b>FPS:</b> <span id="fpsCounter">0</span><br>
      <b>Time:</b> <span id="elapsedTime">0</span>s
    </div>
    <button id="toggleConsole">Toggle Console</button>
    <button id="clearConsole">Clear Console</button>
    <div id="consolePanel"></div>
  </div>
  <div id="editorContainer">
    <h3>Kode Developer</h3>
    <div class="editorGroup">
      <label for="htmlEditor">HTML</label>
      <textarea id="htmlEditor">
<!-- Contoh HTML -->
<div style="text-align:center;">
  <h1>Halo Dunia!</h1>
  <p>Selamat datang di NexGen Side Engine v1.5.0</p>
</div>
      </textarea>
    </div>
    <div class="editorGroup">
      <label for="cssEditor">CSS</label>
      <textarea id="cssEditor">
/* Contoh CSS */
body {
  background: #fafafa;
  color: #333;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}
h1 {
  color: #00bcd4;
}
      </textarea>
    </div>
    <div class="editorGroup">
      <label for="jsEditor">JavaScript</label>
      <textarea id="jsEditor">
// Contoh JavaScript
document.addEventListener('DOMContentLoaded', () => {
  console.log('Halaman Custom Loaded di v1.5.0');
});
      </textarea>
    </div>
    <button id="runFullCode" class="btn">Jalankan Kode Lengkap</button>
  </div>

  <script>
    // ---------- FPS & Elapsed Time ----------
    let lastFrameTime = performance.now();
    let frameCount = 0;
    let elapsedTime = 0;
    function updateFPS() {
      const now = performance.now();
      frameCount++;
      if (now - lastFrameTime >= 1000) {
        const fps = frameCount;
        document.getElementById("fpsCounter").innerText = fps;
        frameCount = 0;
        lastFrameTime = now;
      }
      requestAnimationFrame(updateFPS);
    }
    function updateElapsedTime() {
      elapsedTime += 0.1;
      document.getElementById("elapsedTime").innerText = elapsedTime.toFixed(1);
    }
    setInterval(updateElapsedTime, 100);
    updateFPS();

    // ---------- Live Preview (Debounce) ----------
    let previewDebounce;
    function runFullCode() {
      const htmlCode = document.getElementById("htmlEditor").value;
      const cssCode = document.getElementById("cssEditor").value;
      const jsCode = document.getElementById("jsEditor").value;
      
      // Override console.log di dalam iframe
      const consoleOverride = `
        <script>
          (function() {
            const oldLog = console.log;
            console.log = function(...args) {
              oldLog.apply(console, args);
              window.parent.postMessage({ type: 'console', message: args.join(' ') }, '*');
            };
          })();
        <\/script>
      `;
      
      const completeCode = `
        <!DOCTYPE html>
        <html lang="id">
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1">
          <title>Preview</title>
          <style>${cssCode}</style>
        </head>
        <body>
          ${htmlCode}
          ${consoleOverride}
          <script>${jsCode}<\/script>
        </body>
        </html>
      `;
      
      document.getElementById("previewFrame").srcdoc = completeCode;
    }
    
    // Jalankan live preview setiap ada perubahan (dengan debounce)
    const editors = document.querySelectorAll("#htmlEditor, #cssEditor, #jsEditor");
    editors.forEach(editor => {
      editor.addEventListener("input", () => {
        clearTimeout(previewDebounce);
        previewDebounce = setTimeout(runFullCode, 500);
      });
    });
    
    document.getElementById("runFullCode").addEventListener("click", runFullCode);
    runFullCode();

    // ---------- Console Panel Handling ----------
    const consolePanel = document.getElementById("consolePanel");
    document.getElementById("toggleConsole").addEventListener("click", () => {
      consolePanel.style.display = consolePanel.style.display === 'none' ? 'block' : 'none';
    });
    document.getElementById("clearConsole").addEventListener("click", () => {
      consolePanel.innerText = "";
    });
    window.addEventListener("message", (event) => {
      if (event.data && event.data.type === 'console') {
        consolePanel.innerText += event.data.message + "\n";
        consolePanel.scrollTop = consolePanel.scrollHeight;
      }
    });
  </script>
</body>
</html>
